<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <script src="https://kit.fontawesome.com/11da5eb453.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            display: flex;
            height: 100vh;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            width: fit-content;
            max-width: 80%;
            padding: 12px 16px;
            background: white;
            border: 2px solid;
            border-radius: 16px;
            word-wrap: break-word;
            line-height: 1.4;
            font-size: 14px;
        }

        .footer {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid #eee;
            align-items: center; /* center vertically so send icon aligns */
        }

        .header {
            display: flex;
            align-items: center;
            padding: 0 12px;
            height: 56px;
            background: #111;
            color: #fff;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            overflow: hidden;
            gap: 8px;
        }

        .header .icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.03);
            border: none;
            color: inherit;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .header .icon-btn:hover {
            background: rgba(255,255,255,0.06);
        }

        .header .title {
            flex: 1 1 auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
            font-size: 16px;
            line-height: 1;
            max-height: 40px;
        }

        textarea, input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 16px;
            padding: 12px 16px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        textarea {
            resize: none;
            padding: 8px 12px;
            min-height: 28px; /* initial single-line look */
            max-height: 200px;
            overflow: hidden;
            line-height: 1.4;
        }

        textarea:focus, input:focus {
            border-color: #999;
        }

        /* default button styles retained for other buttons */
        button {
            padding: 10px 24px;
            border: none;
            border-radius: 24px;
            background: #333;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover {
            background: #dbdbdb;
        }

        /* send icon button in footer: icon-only, no background */
        .send-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            padding: 0;
            border: none;
            background: transparent;
            color: #222;
            font-size: 18px;
            cursor: pointer;
        }

        .send-btn:hover {
            color: #000;
        }

        @media (max-width: 600px) {
            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <button class="icon-btn" id="newTabBtn" title="Open in new tab" onclick="openNewTab()">
                <i class="fa-solid fa-plus" aria-hidden="true"></i>
            </button>
            <div class="title" id="firstMessage" title=""></div>
            <button class="icon-btn" id="logoutBtn" title="Logout / Close tab" onclick="logout()">
                <i class="fa-solid fa-arrow-right-from-bracket" aria-hidden="true"></i>
            </button>
        </div>
        <div class="messages" id="messages"></div>
        <div class="footer">
            <textarea id="input" rows="1" placeholder="Type a message..." maxlength="512"></textarea>
            <button class="send-btn" onclick="sendMessage()" aria-label="Send">
                <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <script>
        const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];

        function getRandomColor() {
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // removed automatic/random initial messages â€” messages must be entered by hand

        function addMessage(text) {
            const messagesDiv = document.getElementById('messages');
            const msg = document.createElement('div');
            msg.className = 'message';
            msg.textContent = text;
            msg.style.borderColor = getRandomColor();
            messagesDiv.appendChild(msg);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('input');
            const text = input.value.trim();
            if (!text) return; // require manual input

            const headerTitle = document.getElementById('firstMessage');
            if (headerTitle && !headerTitle.textContent) {
                headerTitle.textContent = text;
                headerTitle.title = text;
            }

            addMessage(text);
            input.value = '';
            if (typeof autoResize === 'function') autoResize(input);
        }

        // textarea auto-resize and Enter handling (Enter = send, Shift+Enter = newline)
        const textarea = document.getElementById('input');
        function autoResize(el) {
            if (!el) return;
            if (!el.value.trim()) {
                el.style.height = '28px';
                return;
            }
            el.style.height = 'auto';
            const h = Math.min(el.scrollHeight, 200);
            el.style.height = h + 'px';
        }

        if (textarea) {
            textarea.addEventListener('input', () => autoResize(textarea));
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            // init height
            autoResize(textarea);
        }

        // No initial message; header will be set when the user sends the very first message.

        function openNewTab() {
            try {
                window.open(window.location.href, '_blank', 'noopener');
            } catch (e) {
                console.warn('Failed to open new tab', e);
            }
        }

        function logout() {
            const msg = 'All your messages will be removed.';
            if (!confirm(msg)) return;

            const messagesDiv = document.getElementById('messages');
            if (messagesDiv) messagesDiv.innerHTML = '';

            const headerTitle = document.getElementById('firstMessage');
            if (headerTitle) {
                headerTitle.textContent = '';
                headerTitle.title = '';
            }

            const input = document.getElementById('input');
            if (input) input.value = '';

            try {
                window.close();
            } catch (e) {
                console.warn('Failed to close window', e);
            }
        }
    </script>
</body>
</html>